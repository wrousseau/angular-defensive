{"version":3,"sources":["angular-defensive.js"],"names":[],"mappings":"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","file":"angular-defensive.js","sourcesContent":["(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n\ttypeof define === 'function' && define.amd ? define(factory) :\n\tglobal.angularDefensive = factory();\n}(this, function () { 'use strict';\n\n\tconst HTTP = new WeakMap();\n\tconst TEMPLATE_CACHE = new WeakMap();\n\n\tclass DefensiveConfiguration {\n\n\t  constructor($http, $templateCache) {\n\t    HTTP.set(this, $http);\n\t    TEMPLATE_CACHE.set(this, $templateCache);\n\t    this.configurations = {};\n\t  }\n\n\t  static get Configuration() {\n\t    return class Configuration {\n\t      constructor() {\n\t        this.cases = [];\n\t      }\n\n\t      addCase(confCase) {\n\t        this.cases.push(confCase);\n\t        return this;\n\t      }\n\t    };\n\t  }\n\n\t  get Configuration() {\n\t    return DefensiveConfiguration.Configuration;\n\t  }\n\n\t  registerConfiguration(configurationName) {\n\t    let configuration = new this.Configuration();\n\t    this.configurations[configurationName] = configuration;\n\t    return configuration;\n\t  }\n\n\t  getTemplate(confCase) {\n\t    let self = this;\n\t    return new Promise(function(resolve) {\n\t      if (confCase.hasOwnProperty('template')) {\n\t        resolve(confCase.template);\n\t      } else if (confCase.hasOwnProperty('templateUrl')) {\n\t        HTTP.get(self)\n\t          .get(confCase.templateUrl, {\n\t            cache: TEMPLATE_CACHE.get(self),\n\t            headers: {Accept: 'text/html'}\n\t          })\n\t          .then(function(response) {\n\t            resolve(response.data);\n\t          });\n\t      }\n\t    });\n\t  }\n\n\t  getDefensiveCase(configurationName) {\n\t    let self = this;\n\t    return new Promise(function(resolve, reject) {\n\t      if (!self.configurations.hasOwnProperty(configurationName)) {\n\t        return reject(`Configuration ${configurationName} does not exist`);\n\t      }\n\t      let configuration = self.configurations[configurationName];\n\t      while (configuration.cases.length) {\n\t        let confCase = configuration.cases.shift();\n\t        if (confCase.check()) {\n\t          return self.getTemplate(confCase)\n\t          .then(function(template) {\n\t            confCase.template = template;\n\t            return resolve(confCase);\n\t          });\n\t        }\n\t      }\n\t    });\n\t  }\n\n\t  static factory($http, $templateCache) {\n\t    return new DefensiveConfiguration($http, $templateCache);\n\t  }\n\n\t}\n\n\tconst CONNECTION_STATUS = new WeakMap();\n\n\tclass CheckPreset {\n\n\t  constructor(connectionStatus) {\n\t    CONNECTION_STATUS.set(this, connectionStatus);\n\t  }\n\n\t  noNetwork() {\n\t    return !connectionStatus.isOnline();\n\t  }\n\n\t  static factory(connectionStatus) {\n\t    return new CheckPreset(connectionStatus);\n\t  }\n\n\t}\n\n\tvar moduleName$2 = 'ngDefensive.services';\n\n\tangular.module(moduleName$2, ['offline'])\n\t  .factory('CheckPreset', CheckPreset.factory)\n\t  .factory('DefensiveConfiguration', DefensiveConfiguration.factory);\n\n\tclass NgDefensive {\n\n\t  constructor($compile, DefensiveConfiguration) {\n\t    this.restrict = 'A';\n\t    this.scope = {\n\t      callbacks: '=ngDefensiveCallbacks'\n\t    };\n\t    this.link = function(scope, element, attrs) {\n\t      let activeCase = null;\n\t      DefensiveConfiguration.getDefensiveCase(attrs.ngDefensive)\n\t      .then(function(confCase) {\n\t        element.replaceWith($compile(confCase.template)(scope));\n\t        activeCase = confCase;\n\t      });\n\t      scope.action = function() {\n\t        scope.callbacks[activeCase.caseName]();\n\t      };\n\t    };\n\t  }\n\n\t  static factory($compile, DefensiveConfiguration) {\n\t    return new NgDefensive($compile, DefensiveConfiguration);\n\t  }\n\n\t}\n\n\tvar moduleName$1 = 'ngDefensive.directives';\n\n\tangular.module(moduleName$1, [])\n\t  .directive('ngDefensive', NgDefensive.factory);\n\n\tvar moduleName = 'ngDefensive';\n\n\tvar app = angular.module(moduleName, [\n\t\tmoduleName$1,\n\t\tmoduleName$2\n\t]);\n\n\treturn moduleName;\n\n}));"],"sourceRoot":"/source/"}